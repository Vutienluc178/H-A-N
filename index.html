<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản Lý Học Sinh Lớp 10A1</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .modal { background: rgba(0,0,0,0.3); }
        .tab-active { border-bottom: 2px solid #4F46E5; color: #4F46E5 !important; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">

    <!-- Header -->
    <header class="gradient-bg text-white shadow-lg">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <i class="fas fa-graduation-cap text-2xl"></i>
                <h1 class="text-lg md:text-2xl font-bold">Quản Lý Học Sinh Lớp 10A1</h1>
            </div>
            <div class="flex items-center space-x-3">
                <span class="hidden md:inline">GV Chủ nhiệm: Cô Nguyễn Thị Lan</span>
                <i class="fas fa-bell text-xl cursor-pointer relative" onclick="showTab('notifications')">
                  <span id="notifyCount" class="absolute -top-2 -right-2 bg-red-600 text-xs rounded-full px-2">0</span>
                </i>
            </div>
        </div>
    </header>

    <!-- Tabs Navigation -->
    <nav class="bg-white shadow">
        <div class="container mx-auto px-4 flex space-x-6 md:space-x-10">
            <button class="py-3 px-2 font-medium tab-active" id="tab_dashboard" onclick="showTab('dashboard')"><i class="fas fa-chart-line mr-2"></i>Tổng Quan</button>
            <button class="py-3 px-2 font-medium" id="tab_students" onclick="showTab('students')"><i class="fas fa-users mr-2"></i>Học Sinh</button>
            <button class="py-3 px-2 font-medium" id="tab_scores" onclick="showTab('scores')"><i class="fas fa-book mr-2"></i>Điểm</button>
            <button class="py-3 px-2 font-medium" id="tab_discipline" onclick="showTab('discipline')"><i class="fas fa-exclamation-triangle mr-2"></i>Nề Nếp</button>
            <button class="py-3 px-2 font-medium" id="tab_notifications" onclick="showTab('notifications')"><i class="fas fa-bullhorn mr-2"></i>Thông Báo</button>
        </div>
    </nav>

    <main class="container mx-auto px-4 py-6">
        <!-- Dashboard -->
        <div id="dashboard" class="tab-content">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                <div class="bg-white rounded-lg shadow p-4 flex items-center">
                    <i class="fas fa-users text-blue-600 text-2xl mr-3"></i>
                    <div>
                        <div class="text-xs text-gray-500">Tổng học sinh</div>
                        <div class="text-lg font-bold" id="totalStudents">0</div>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow p-4 flex items-center">
                    <i class="fas fa-star text-green-500 text-2xl mr-3"></i>
                    <div>
                        <div class="text-xs text-gray-500">Điểm TB lớp</div>
                        <div class="text-lg font-bold" id="avgScore">0</div>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow p-4 flex items-center">
                    <i class="fas fa-exclamation-circle text-red-500 text-2xl mr-3"></i>
                    <div>
                        <div class="text-xs text-gray-500">Lỗi nề nếp</div>
                        <div class="text-lg font-bold" id="totalViolations">0</div>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow p-4 flex items-center">
                    <i class="fas fa-bullhorn text-purple-500 text-2xl mr-3"></i>
                    <div>
                        <div class="text-xs text-gray-500">Thông báo đã gửi</div>
                        <div class="text-lg font-bold" id="totalNotices">0</div>
                    </div>
                </div>
            </div>
            <h3 class="font-bold mb-2 text-lg">Thống kê nhanh</h3>
            <ul class="list-disc ml-5 space-y-1 text-gray-700">
                <li>Cập nhật học sinh, điểm và lỗi nề nếp nhanh gọn.</li>
                <li>Dữ liệu chỉ lưu tại trình duyệt cá nhân (bảo mật, không cần đăng nhập).</li>
                <li>Có thể tải/xuất dữ liệu (thêm nếu bạn cần).</li>
            </ul>
        </div>

        <!-- Học Sinh -->
        <div id="students" class="tab-content hidden">
            <div class="flex flex-col md:flex-row md:items-end md:space-x-4 mb-4">
                <div class="mb-2 md:mb-0 flex-1">
                    <input id="searchStudent" type="text" class="w-full border px-3 py-2 rounded" placeholder="Tìm tên học sinh...">
                </div>
                <button onclick="openStudentModal()" class="bg-blue-600 text-white px-4 py-2 rounded mb-2 md:mb-0"><i class="fas fa-plus mr-1"></i>Thêm học sinh</button>
            </div>
            <table class="w-full table-auto bg-white rounded shadow overflow-hidden">
                <thead class="bg-gray-100">
                    <tr>
                        <th class="px-3 py-2 text-left">STT</th>
                        <th class="px-3 py-2 text-left">Tên học sinh</th>
                        <th class="px-3 py-2 text-left">Giới tính</th>
                        <th class="px-3 py-2 text-left">Ngày sinh</th>
                        <th class="px-3 py-2 text-left">SĐT PH</th>
                        <th class="px-3 py-2 text-left">Tác vụ</th>
                    </tr>
                </thead>
                <tbody id="studentTable" class="divide-y"></tbody>
            </table>
        </div>

        <!-- Điểm -->
        <div id="scores" class="tab-content hidden">
            <div class="mb-4">
                <button onclick="openScoreModal()" class="bg-green-600 text-white px-4 py-2 rounded"><i class="fas fa-plus mr-1"></i>Nhập điểm</button>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full table-auto bg-white rounded shadow">
                    <thead class="bg-gray-100">
                        <tr>
                            <th class="px-3 py-2 text-left">Tên học sinh</th>
                            <th class="px-3 py-2 text-left">Toán</th>
                            <th class="px-3 py-2 text-left">Văn</th>
                            <th class="px-3 py-2 text-left">Anh</th>
                            <th class="px-3 py-2 text-left">Lý</th>
                            <th class="px-3 py-2 text-left">TB</th>
                        </tr>
                    </thead>
                    <tbody id="scoreTable"></tbody>
                </table>
            </div>
        </div>

        <!-- Nề Nếp -->
        <div id="discipline" class="tab-content hidden">
            <div class="mb-4">
                <button onclick="openViolationModal()" class="bg-red-600 text-white px-4 py-2 rounded"><i class="fas fa-plus mr-1"></i>Ghi nhận vi phạm</button>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full table-auto bg-white rounded shadow">
                    <thead class="bg-gray-100">
                        <tr>
                            <th class="px-3 py-2 text-left">Tên học sinh</th>
                            <th class="px-3 py-2 text-left">Ngày</th>
                            <th class="px-3 py-2 text-left">Lỗi vi phạm</th>
                            <th class="px-3 py-2 text-left">Ghi chú</th>
                        </tr>
                    </thead>
                    <tbody id="violationTable"></tbody>
                </table>
            </div>
        </div>

        <!-- Thông báo -->
        <div id="notifications" class="tab-content hidden">
            <div class="mb-4">
                <button onclick="openNoticeModal()" class="bg-purple-600 text-white px-4 py-2 rounded"><i class="fas fa-plus mr-1"></i>Gửi thông báo</button>
            </div>
            <div id="noticeList" class="space-y-3"></div>
        </div>
    </main>

    <!-- Modals (ẩn/hiện bằng JS) -->
    <!-- Thêm/sửa học sinh -->
    <div id="studentModal" class="modal hidden fixed inset-0 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 w-full max-w-md">
            <h3 class="font-bold mb-3 text-lg" id="studentModalTitle">Thêm học sinh</h3>
            <div class="space-y-3">
                <input id="studentName" type="text" class="border w-full px-3 py-2 rounded" placeholder="Tên học sinh">
                <input id="studentGender" type="text" class="border w-full px-3 py-2 rounded" placeholder="Giới tính">
                <input id="studentBirth" type="date" class="border w-full px-3 py-2 rounded" placeholder="Ngày sinh">
                <input id="studentPhone" type="text" class="border w-full px-3 py-2 rounded" placeholder="SĐT phụ huynh">
            </div>
            <div class="flex justify-end space-x-2 mt-5">
                <button onclick="closeStudentModal()" class="bg-gray-300 px-4 py-2 rounded">Huỷ</button>
                <button onclick="saveStudent()" class="bg-blue-600 text-white px-4 py-2 rounded" id="btnSaveStudent">Lưu</button>
            </div>
        </div>
    </div>

    <!-- Nhập điểm -->
    <div id="scoreModal" class="modal hidden fixed inset-0 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 w-full max-w-md">
            <h3 class="font-bold mb-3 text-lg">Nhập điểm học sinh</h3>
            <div class="space-y-3">
                <select id="scoreStudent" class="border w-full px-3 py-2 rounded"></select>
                <input id="scoreMath" type="number" min="0" max="10" step="0.1" class="border w-full px-3 py-2 rounded" placeholder="Toán">
                <input id="scoreLiter" type="number" min="0" max="10" step="0.1" class="border w-full px-3 py-2 rounded" placeholder="Văn">
                <input id="scoreEng" type="number" min="0" max="10" step="0.1" class="border w-full px-3 py-2 rounded" placeholder="Anh">
                <input id="scorePhys" type="number" min="0" max="10" step="0.1" class="border w-full px-3 py-2 rounded" placeholder="Lý">
            </div>
            <div class="flex justify-end space-x-2 mt-5">
                <button onclick="closeScoreModal()" class="bg-gray-300 px-4 py-2 rounded">Huỷ</button>
                <button onclick="saveScore()" class="bg-green-600 text-white px-4 py-2 rounded">Lưu điểm</button>
            </div>
        </div>
    </div>

    <!-- Ghi nhận vi phạm -->
    <div id="violationModal" class="modal hidden fixed inset-0 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 w-full max-w-md">
            <h3 class="font-bold mb-3 text-lg">Ghi nhận vi phạm</h3>
            <div class="space-y-3">
                <select id="violationStudent" class="border w-full px-3 py-2 rounded"></select>
                <input id="violationDate" type="date" class="border w-full px-3 py-2 rounded">
                <input id="violationDesc" type="text" class="border w-full px-3 py-2 rounded" placeholder="Lỗi vi phạm">
                <input id="violationNote" type="text" class="border w-full px-3 py-2 rounded" placeholder="Ghi chú">
            </div>
            <div class="flex justify-end space-x-2 mt-5">
                <button onclick="closeViolationModal()" class="bg-gray-300 px-4 py-2 rounded">Huỷ</button>
                <button onclick="saveViolation()" class="bg-red-600 text-white px-4 py-2 rounded">Lưu vi phạm</button>
            </div>
        </div>
    </div>

    <!-- Gửi thông báo -->
    <div id="noticeModal" class="modal hidden fixed inset-0 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 w-full max-w-md">
            <h3 class="font-bold mb-3 text-lg">Gửi thông báo</h3>
            <div class="space-y-3">
                <input id="noticeTitle" type="text" class="border w-full px-3 py-2 rounded" placeholder="Tiêu đề">
                <textarea id="noticeContent" class="border w-full px-3 py-2 rounded" rows="3" placeholder="Nội dung thông báo"></textarea>
            </div>
            <div class="flex justify-end space-x-2 mt-5">
                <button onclick="closeNoticeModal()" class="bg-gray-300 px-4 py-2 rounded">Huỷ</button>
                <button onclick="saveNotice()" class="bg-purple-600 text-white px-4 py-2 rounded">Gửi thông báo</button>
            </div>
        </div>
    </div>

    <script>
    // ===== DATA & STORAGE =====
    let students = JSON.parse(localStorage.getItem('qlhs_students') || '[]');
    let scores = JSON.parse(localStorage.getItem('qlhs_scores') || '{}');
    let violations = JSON.parse(localStorage.getItem('qlhs_violations') || '[]');
    let notices = JSON.parse(localStorage.getItem('qlhs_notices') || '[]');
    let editingIdx = -1;

    // ===== TABS =====
    function showTab(tab) {
        document.querySelectorAll('.tab-content').forEach(e=>e.classList.add('hidden'));
        document.getElementById(tab).classList.remove('hidden');
        document.querySelectorAll('nav button').forEach(btn=>btn.classList.remove('tab-active'));
        document.getElementById('tab_' + tab).classList.add('tab-active');
        if(tab==='notifications') updateNotifyCount(0);
    }

    // ===== STUDENTS CRUD =====
    function renderStudentTable(filter='') {
        let html = '';
        students.forEach((s, i) => {
            if(filter && !s.name.toLowerCase().includes(filter.toLowerCase())) return;
            html += `<tr>
                <td class="px-3 py-2">${i+1}</td>
                <td class="px-3 py-2 font-bold">${s.name}</td>
                <td class="px-3 py-2">${s.gender||''}</td>
                <td class="px-3 py-2">${s.birth||''}</td>
                <td class="px-3 py-2">${s.phone||''}</td>
                <td class="px-3 py-2 flex space-x-2">
                  <button onclick="editStudent(${i})" class="text-blue-600"><i class="fas fa-edit"></i></button>
                  <button onclick="delStudent(${i})" class="text-red-600"><i class="fas fa-trash"></i></button>
                </td>
            </tr>`;
        });
        document.getElementById('studentTable').innerHTML = html || `<tr><td colspan="6" class="px-3 py-2 text-center text-gray-400">Chưa có học sinh.</td></tr>`;
        updateStats();
    }
    function openStudentModal(editIdx=-1) {
        editingIdx = editIdx;
        document.getElementById('studentModalTitle').innerText = editIdx<0?'Thêm học sinh':'Sửa học sinh';
        let s = students[editIdx]||{};
        document.getElementById('studentName').value = s.name||'';
        document.getElementById('studentGender').value = s.gender||'';
        document.getElementById('studentBirth').value = s.birth||'';
        document.getElementById('studentPhone').value = s.phone||'';
        document.getElementById('studentModal').classList.remove('hidden');
    }
    function closeStudentModal() { document.getElementById('studentModal').classList.add('hidden'); }
    function saveStudent() {
        let name = document.getElementById('studentName').value.trim();
        let gender = document.getElementById('studentGender').value.trim();
        let birth = document.getElementById('studentBirth').value;
        let phone = document.getElementById('studentPhone').value.trim();
        if(!name) return alert('Nhập tên học sinh!');
        let s = { name, gender, birth, phone };
        if(editingIdx<0) students.push(s);
        else students[editingIdx]=s;
        localStorage.setItem('qlhs_students',JSON.stringify(students));
        closeStudentModal();
        renderStudentTable(document.getElementById('searchStudent').value);
        renderScoreTable();
        renderViolationTable();
        fillStudentSelect();
    }
    function delStudent(idx) {
        if(confirm('Xoá học sinh này?')) {
            students.splice(idx,1);
            localStorage.setItem('qlhs_students',JSON.stringify(students));
            renderStudentTable(document.getElementById('searchStudent').value);
            renderScoreTable();
            renderViolationTable();
            fillStudentSelect();
        }
    }
    function editStudent(idx) { openStudentModal(idx); }

    document.getElementById('searchStudent').oninput = function(e) {
        renderStudentTable(e.target.value);
    };

    // ===== SCORES =====
    function renderScoreTable() {
        let html = '';
        students.forEach(s=>{
            let sc = scores[s.name]||{};
            let tb = calcAvg(sc);
            html += `<tr>
                <td class="px-3 py-2">${s.name}</td>
                <td class="px-3 py-2">${val(sc.math)}</td>
                <td class="px-3 py-2">${val(sc.liter)}</td>
                <td class="px-3 py-2">${val(sc.eng)}</td>
                <td class="px-3 py-2">${val(sc.phys)}</td>
                <td class="px-3 py-2 font-bold ${tb>=8?'text-green-600':tb>=6.5?'text-blue-600':'text-red-600'}">${tb||''}</td>
            </tr>`;
        });
        document.getElementById('scoreTable').innerHTML = html || `<tr><td colspan="6" class="px-3 py-2 text-center text-gray-400">Chưa có dữ liệu.</td></tr>`;
        updateStats();
    }
    function openScoreModal() {
        fillStudentSelect('scoreStudent');
        document.getElementById('scoreMath').value='';
        document.getElementById('scoreLiter').value='';
        document.getElementById('scoreEng').value='';
        document.getElementById('scorePhys').value='';
        document.getElementById('scoreModal').classList.remove('hidden');
    }
    function closeScoreModal() { document.getElementById('scoreModal').classList.add('hidden'); }
    function saveScore() {
        let name = document.getElementById('scoreStudent').value;
        let math = +document.getElementById('scoreMath').value;
        let liter = +document.getElementById('scoreLiter').value;
        let eng = +document.getElementById('scoreEng').value;
        let phys = +document.getElementById('scorePhys').value;
        if(!name) return alert('Chọn học sinh!');
        scores[name] = { math, liter, eng, phys };
        localStorage.setItem('qlhs_scores', JSON.stringify(scores));
        closeScoreModal();
        renderScoreTable();
        updateStats();
    }
    function val(x) { return (typeof x==='number'&&!isNaN(x))?x:''; }
    function calcAvg(sc) {
        let arr = [sc.math, sc.liter, sc.eng, sc.phys].filter(x=>typeof x==='number' && !isNaN(x));
        if(arr.length==0) return '';
        return (arr.reduce((a,b)=>a+b,0)/arr.length).toFixed(1);
    }

    // ===== VIOLATIONS =====
    function renderViolationTable() {
        let html = '';
        violations.forEach(v=>{
            html += `<tr>
                <td class="px-3 py-2">${v.name}</td>
                <td class="px-3 py-2">${v.date||''}</td>
                <td class="px-3 py-2">${v.desc||''}</td>
                <td class="px-3 py-2">${v.note||''}</td>
            </tr>`;
        });
        document.getElementById('violationTable').innerHTML = html || `<tr><td colspan="4" class="px-3 py-2 text-center text-gray-400">Chưa có dữ liệu.</td></tr>`;
        updateStats();
    }
    function openViolationModal() {
        fillStudentSelect('violationStudent');
        document.getElementById('violationDate').value = '';
        document.getElementById('violationDesc').value = '';
        document.getElementById('violationNote').value = '';
        document.getElementById('violationModal').classList.remove('hidden');
    }
    function closeViolationModal() { document.getElementById('violationModal').classList.add('hidden'); }
    function saveViolation() {
        let name = document.getElementById('violationStudent').value;
        let date = document.getElementById('violationDate').value;
        let desc = document.getElementById('violationDesc').value.trim();
        let note = document.getElementById('violationNote').value.trim();
        if(!name || !desc) return alert('Nhập đầy đủ thông tin!');
        violations.push({ name, date, desc, note });
        localStorage.setItem('qlhs_violations', JSON.stringify(violations));
        closeViolationModal();
        renderViolationTable();
        updateStats();
    }

    // ===== NOTICES =====
    function renderNoticeList() {
        let html = '';
        notices.slice().reverse().forEach(n=>{
            html += `<div class="bg-white shadow rounded p-4">
                <div class="font-bold text-purple-700 mb-1">${n.title}</div>
                <div class="text-gray-700 mb-2">${n.content}</div>
                <div class="text-xs text-gray-500 text-right">${n.time}</div>
            </div>`;
        });
        document.getElementById('noticeList').innerHTML = html || `<div class="text-gray-400 text-center py-10">Chưa có thông báo nào.</div>`;
        updateNotifyCount();
        updateStats();
    }
    function openNoticeModal() {
        document.getElementById('noticeTitle').value='';
        document.getElementById('noticeContent').value='';
        document.getElementById('noticeModal').classList.remove('hidden');
    }
    function closeNoticeModal() { document.getElementById('noticeModal').classList.add('hidden'); }
    function saveNotice() {
        let title = document.getElementById('noticeTitle').value.trim();
        let content = document.getElementById('noticeContent').value.trim();
        if(!title||!content) return alert('Nhập tiêu đề và nội dung!');
        let time = (new Date()).toLocaleString('vi-VN');
        notices.push({ title, content, time });
        localStorage.setItem('qlhs_notices', JSON.stringify(notices));
        closeNoticeModal();
        renderNoticeList();
        updateNotifyCount(1);
        updateStats();
    }
    function updateNotifyCount(plus=0) {
        let c = notices.length+(plus?1:0);
        document.getElementById('notifyCount').innerText = c;
        document.getElementById('totalNotices') && (document.getElementById('totalNotices').innerText = c);
    }

    // ===== CHUNG =====
    function fillStudentSelect(id='scoreStudent') {
        let sel = document.getElementById(id);
        if(!sel) return;
        sel.innerHTML = `<option value="">-- Chọn học sinh --</option>`+students.map(s=>`<option>${s.name}</option>`).join('');
    }
    function updateStats() {
        document.getElementById('totalStudents')&&(document.getElementById('totalStudents').innerText=students.length);
        let all = Object.values(scores).map(calcAvg).filter(x=>x!=='').map(Number);
        let tb = all.length? (all.reduce((a,b)=>a+b,0)/all.length).toFixed(1):0;
        document.getElementById('avgScore')&&(document.getElementById('avgScore').innerText=tb);
        document.getElementById('totalViolations')&&(document.getElementById('totalViolations').innerText=violations.length);
        updateNotifyCount();
    }

    // ===== MODAL CLOSE =====
    window.onclick = function(e) {
        ['studentModal','scoreModal','violationModal','noticeModal'].forEach(id=>{
            let modal=document.getElementById(id);
            if(e.target===modal) modal.classList.add('hidden');
        });
    };

    // ===== INIT =====
    renderStudentTable();
    renderScoreTable();
    renderViolationTable();
    renderNoticeList();
    fillStudentSelect();

    // Khi đổi tab đầu tiên
    showTab('dashboard');
    </script>
</body>
</html>
